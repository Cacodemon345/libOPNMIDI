VERSION=1.0.0
ARCHNAME=opnmidi-$(VERSION)
ARCHDIR=archives/
NOGZIPARCHIVES=1

ARCHFILES=\
	src/opnmidi.cpp src/opnmidi.h \
    src/opnmidi_load.cpp src/opnmidi_midiplay.cpp src/opnmidi_opn2.cpp src/opnmidi_private.cpp \
	src/dbopl.cpp src/dbopl.h \
	src/adldata.cpp src/opnbank.h \
	make.rules \
	fraction.h \
	\
	fm_banks/gm.wopn

INSTALLPROGS=opnmidi

all: directories libopnmidi.so

directories:
	${MKDIR} obj
	${MKDIR} bin

libopnmidi.so: obj/opnmidi.o obj/opnmidi_load.o obj/opnmidi_midiplay.o obj/opnmidi_opn2.o obj/opnmidi_private.o obj/opnmidi_xmi2mid.o obj/opnmidi_mus2mid.o obj/Ym2612_ChipEmu.o
	$(CXXLINK)  $^  $(DEBUG) -shared -o bin/$@  $(LDLIBS)

obj/opnmidi.o: src/opnmidi.cpp src/opnmidi.h src/Ym2612_ChipEmu.h src/opnbank.h
	$(CXX) $(CPPFLAGS) $<  $(DEBUG) -c -fPIC -o $@

obj/opnmidi_load.o: src/opnmidi_load.cpp src/opnmidi_private.hpp src/opnmidi.h src/opnbank.h
	$(CXX) $(CPPFLAGS) $<  $(DEBUG) -c -fPIC -o $@

obj/opnmidi_midiplay.o: src/opnmidi_midiplay.cpp src/opnmidi_private.hpp src/opnmidi.h src/opnbank.h
	$(CXX) $(CPPFLAGS) $<  $(DEBUG) -c -fPIC -o $@

obj/opnmidi_opn2.o: src/opnmidi_opn2.cpp src/opnmidi_private.hpp src/opnmidi.h src/opnbank.h
	$(CXX) $(CPPFLAGS) $<  $(DEBUG) -c -fPIC -o $@

obj/opnmidi_private.o: src/opnmidi_private.cpp src/opnmidi_private.hpp src/opnmidi.h src/opnbank.h
	$(CXX) $(CPPFLAGS) $<  $(DEBUG) -c -fPIC -o $@

obj/Ym2612_ChipEmu.o: src/Ym2612_ChipEmu.cpp src/Ym2612_ChipEmu.h
	$(CC) $(CFLAGS) $<  $(DEBUG)  -c -fPIC -o $@

obj/opnmidi_xmi2mid.o: src/opnmidi_xmi2mid.c src/opnmidi_xmi2mid.h
	$(CC) $(CFLAGS) $<  $(DEBUG)  -c -fPIC -o $@

obj/opnmidi_mus2mid.o: src/opnmidi_mus2mid.c src/opnmidi_mus2mid.h
	$(CC) $(CFLAGS) $<  $(DEBUG)  -c -fPIC -o $@

.PHONY: clean

clean:
	${RM_F} obj bin

include depfun.mak


